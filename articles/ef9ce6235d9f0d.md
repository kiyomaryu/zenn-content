---
title: "Terraform+ansibleã«ã¦GCPã®GCEã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã—ã¦ã¿ãŸ"
emoji: "ğŸ“–"
type: "tech"
topics: []
published: false
---



## ã¯ã˜ã‚ã«


## æ‰‹é †

ä»Šå›ã¯ä¸‹è¨˜ã®è¨˜äº‹ã®æ‰‹é †ã‚’å‚è€ƒã«å®Ÿæ–½ã—ã¾ã™ã€‚  

- [GCPã§åŸºæœ¬ã«æˆ»ã£ã¦å§‹ã‚ã‚‹å®Ÿè·µ Infrastructure as codeå†å…¥é–€#1](https://tech.visasq.com/restart-gcp-infrastructure-as-code1/)

è‡ªåˆ†ã®ç’°å¢ƒOSãŒubuntuã ã£ãŸã‚Šã¨ä¸€éƒ¨é•ã†ã¨ã“ã‚ãŒã‚ã‚Šã¾ã™ãŒãã‚Œã‚‚å«ã‚ã¦è¨˜è¼‰ã—ã¾ã™

## ä½œæ¥­ãƒ­ã‚°

### ç’°å¢ƒ

```bash
kyo@DESKTOP-EFHIULV:~/repo/iac$ cat /etc/os-release 
NAME="Ubuntu"
VERSION="20.04.3 LTS (Focal Fossa)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 20.04.3 LTS"
VERSION_ID="20.04"
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
VERSION_CODENAME=focal
UBUNTU_CODENAME=focal
```

### Terraformã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

- [å…¬å¼æ‰‹é †](https://learn.hashicorp.com/tutorials/terraform/install-cli?in=terraform/gcp-get-started)é€šã‚Šã«ã„ã‚Œã‚‹
```bash
sudo apt-get update && sudo apt-get install -y gnupg software-properties-common curl
curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
sudo apt-add-repository "deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main"
sudo apt-get update && sudo apt-get install terraform
```

è¨˜è¿°ã«ãªã‚Œã‚‹ãŸã‚ã«å…¬å¼ã®webãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã§ãã‚‹ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ã‚„ã£ãŸ
![](https://storage.googleapis.com/zenn-user-upload/a8c0afa5795e-20220208.png)
ã‚ã‹ã‚Šã‚„ã™ã„ã€‚è‰¯ãã€‚


### gcloudã‚³ãƒãƒ³ãƒ‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

- ã“ã‚Œã¯æ—¢ã«å®Ÿæ–½æ¸ˆã¿ã®ãŸã‚å‰²æ„›


## terraformç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
```bash
kyo@DESKTOP-EFHIULV:~/repo/iac/terraform$ tree
.
â”œâ”€â”€ Makefile
â”œâ”€â”€ bakcends
â”‚   â”œâ”€â”€ dev.tfvars
â”‚   â”œâ”€â”€ prod.tfvars
â”‚   â””â”€â”€ stg.tfvars
â”œâ”€â”€ main.tf
â”œâ”€â”€ modules
â”‚   â”œâ”€â”€ iam
â”‚   â”‚   â””â”€â”€ main.tf
â”‚   â””â”€â”€ vm
â”‚       â”œâ”€â”€ main.tf
â”‚       â””â”€â”€ variables.tf
â”œâ”€â”€ variables.tf
â””â”€â”€ vars
    â”œâ”€â”€ dev.tfvars
    â”œâ”€â”€ prod.tfvars
    â””â”€â”€ stg.tfvars
```

## tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’GCSã«ä¿å­˜ã™ã‚‹ã‚ˆã†ã«è¨­å®š

ã‚¤ãƒ³ãƒ•ãƒ©ã®çŠ¶æ…‹ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹tfstateãƒ•ã‚¡ã‚¤ãƒ«ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚‹ãã†ã§ã™ãŒã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã«ãªã‚‹ãã†ã§ã™ã€‚tfstateãƒ•ã‚¡ã‚¤ãƒ«ã¯IPã‚„DBã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã©ãŒè¨˜è¼‰ã•ã‚Œã¦ãŠã‚Šãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã«ã—ã¦ã„ã¦èª¤ã£ã¦gitã«pushç­‰ã™ã‚‹ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã‚Šã¾ã™ã€‚  
ã¾ãŸä»–ã®ãƒ¦ãƒ¼ã‚¶ãŒterraformã‚’å®Ÿè¡Œã™ã‚‹ã¨tfstateãƒ•ã‚¡ã‚¤ãƒ«ãŒç•°ãªã‚‹ãŸã‚å†åº¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¦ã—ã¾ã†ãŸã‚GCPã®CSã«ä¿å­˜ã—ã¦å…±é€šåŒ–ã‚’ã—ã¾ã™ã€‚







## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
- [ansible](https://docs.ansible.com/ansible/2.9_ja/user_guide/playbooks_best_practices.html#playbooks-best-practices)
- [terraform](https://www.terraform-best-practices.com/examples)


## å‚è€ƒãƒªãƒ³ã‚¯
- [GCPã§åŸºæœ¬ã«æˆ»ã£ã¦å§‹ã‚ã‚‹å®Ÿè·µ Infrastructure as codeå†å…¥é–€#1](https://tech.visasq.com/restart-gcp-infrastructure-as-code1/)
- [Terraformå…¬å¼ã®GCPã¸ã®è¨­å®š](https://learn.hashicorp.com/collections/terraform/gcp-get-started)
